<html>

<head>
    <link rel="stylesheet" href="styles.css">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
    <script src="//unpkg.com/alpinejs" defer></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body x-init="console.log('initialized')">
    <!-- <div id="checker-board" class="bootstrap-off"> -->
    <div id="checker-board">
        <template x-for='x in 8'>
            <template x-for='y in 8'>
                <div :class="((x+y) % 2 == 0 ? 'light' : 'dark') + ' square'" :id='`${x}${y}`'
                    @click='$store.to = `${x}${y}`'>
                    <template x-if="$store.red.includes(`${x}${y}`)">
                        <div class="red checker"></div>
                    </template>
                    <template x-if="$store.black.includes(`${x}${y}`)">
                        <div class="black checker" @click='$store.from = `${x}${y}`'></div>
                    </template>
                </div>
            </template>
        </template>

        <!-- <template x-for='i in 12'>
            <div class="black checker" x-bind:id="`black-checker-` + i" @click='from = `black-checker-${i}`'></div>
        </template> -->


        <!-- <template x-for='i in 12'>
            <div class="red checker" x-bind:id="`red-checker-` + i" @click='from = `red-checker-${i}`'></div>
        </template> -->

    </div>

    <form @submit.prevent="() => send()" action="/move" method="POST">
        From: <input type="text" name="first_name" x-model='$store.from'> <br>
        To: <input type="text" name="last_name" x-model='$store.to'>
        <input type="submit" value="Submit">
    </form>


    <button @click="() => enemyMove()">enemy?</button>

    <script>
        // function place() {

        //     let board = document.getElementById('checker-board');
        //     let redCheckers = [];
        //     let blackCheckers = [];

        //     for (let i = 1; i <= 12; i++) {
        //         let redChecker = document.getElementById('red-checker-' + i);
        //         let blackChecker = document.getElementById('black-checker-' + i);
        //         console.log(redChecker, blackChecker)

        //         let col = (i - 1) % 4;
        //         let row = Math.floor((i - 1) / 4);

        //         redChecker.style.top = 50 + 50 * row - 45;
        //         redChecker.style.left = 100 + 100 * col - 95 + (row === 1 ? 50 : 0);

        //         blackChecker.style.top = 310 - (50 * row - 45);
        //         blackChecker.style.left = 100 + 100 * col - 95 + (row !== 1 ? 50 : 0);

        //         redCheckers.push(redChecker);
        //         blackCheckers.push(blackChecker);
        //     }
        // }
        function enemyMove() {
            let enemy = ''
            // while(enemyMove == ''){
            axios
                .get('/enemy')
                .then(({ data }) => {
                    console.log('enemy move:', data);
                    const {from, to} = data
                    const oldBlacks = Alpine.store('red');
                    const newBlacks = [...oldBlacks.filter(el => el != from), to]
                    Alpine.store('red', newBlacks)
                })
            // }
        }
        function send() {
            const from = Alpine.store('from');
            const to = Alpine.store('to');
            if (from !== '' && to !== '' && from !== to)
                axios
                    .post('/move', { from, to })
                    .then(res => {
                        console.log('response:', res);
                        if (res.data === 'ACCEPT') {
                            const oldBlacks = Alpine.store('black');
                            const newBlacks = [...oldBlacks.filter(el => el != from), to]
                            Alpine.store('black', newBlacks)
                            setTimeout(() => enemyMove(), 5000);
                        }
                        if (res.data === 'ERROR') {
                            alert("Wrong move, try again")
                        }
                    })
            Alpine.store('from', '');
            Alpine.store('to', '')
        }
        document.addEventListener('alpine:init', () => {
            Alpine.store('black', [
                '32', '34', '36', '38',
                '21', '23', '25', '27',
                '12', '14', '16', '18'
            ])
            Alpine.store('red', [
                '81', '83', '85', '87',
                '72', '74', '76', '78',
                '61', '63', '65', '67'
            ])
            Alpine.store('from', '')
            Alpine.store('to', '')
        })
        // document.addEventListener('alpine:initialized', () => {
        //     place();
        // })
    </script>
</body>

</html>